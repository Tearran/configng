#!/bin/bash

# allows CTRL c to exit
trap "exit" INT TERM

# Get the script directory
script_dir="$(dirname "$0")"
lib_dir="$script_dir/../lib/armbian-config"
doc_dir="$script_dir/../share/doc/armbian-config"

declare -A module_options

# Load the initialize modules
source "$script_dir/../lib/armbian-config/config.initialize.sh"

# Start loading messages
checkpoint reset
checkpoint debug "Initializing script"

source "$lib_dir/config.framework.sh"
checkpoint debug "Load Framework..."

initialize_interface
checkpoint debug "Initialize text user interface ($DIALOG)..."

interface_colors 0
checkpoint debug "Set tui dark background..."

initialize_variables
checkpoint debug "Check Systems variables..."

check_distro_status

source "$lib_dir/config.docs.sh"
checkpoint debug "Loaded Help messages..."

source "$lib_dir/config.system.sh"
checkpoint debug "Loaded System modules..."

source "$lib_dir/config.network.sh"
checkpoint debug "Loaded Network modules..."

source "$lib_dir/config.software.sh"
checkpoint debug "Loaded Software modules..."

case "$1" in
    "--help"|"help"|"-h")
        if [[ -n "$2" ]]; then
            fn=$(sanitize "$2") || die
            shift 2
            "$fn" "help"
        else
            _module_list
        fi
    ;;
    
    "")
        checkpoint debug "Launching TUI"
        interface_menu interface_categories
        checkpoint debug "Exited TUI"
        about_armbian_configng
    ;;

    *)
        checkpoint debug "Starting module call"
        fn=$(sanitize "$1") || die
        "$fn" "$@"
        checkpoint debug "Finished module call"
    ;;


esac

checkpoint total
