#!/bin/bash

# allows CTRL c to exit
trap "exit" INT TERM

# PATH
script_dir="$(dirname "$0")"
SCRIPT_DIR="$(dirname "$0")"
LIB_DIR="$SCRIPT_DIR/../lib/armbian-config"
doc_dir="$script_dir/../share/doc/armbian-config"
DOC_DIR="$SCRIPT_DIR/../share/doc/armbian-config"

unset module_options
declare -A hardware_options
declare -A software_options
declare -A network_options
declare -A framework_options
declare -A module_options

# Load the initialize modules
source "$LIB_DIR/config.initialize.sh"

# Start loading messages
checkpoint reset
checkpoint debug "Initializing script"

source "$LIB_DIR/config.framework.sh"
checkpoint debug "Load Framework..."

initialize_interface
checkpoint debug "Initialize text user interface ($DIALOG)..."

interface_colors 0
checkpoint debug "Set tui dark background..."

initialize_variables
checkpoint debug "Check Systems variables..."

check_distro_status

source "$LIB_DIR/config.system.sh"
checkpoint debug "Loaded System modules..."

source "$LIB_DIR/config.network.sh"
checkpoint debug "Loaded Network modules..."

source "$LIB_DIR/config.software.sh"
checkpoint debug "Loaded Software modules..."

merge_arrays_into_module_options framework_options #network_options software_options hardware_options


case "$1" in
    "--help"|"help"|"-h")
        if [[ -n "$2" ]]; then
            fn=$(sanitize "$2") || die
            shift 2
            "$fn" "help"
        else
            options_list module_options
        fi
    ;;

    
    "")
        interface_colors 4
        checkpoint debug "Launching TUI"
        interface_menu interface_categories
        checkpoint debug "Exited TUI"
        about_armbian_configng
    ;;

    *)
        checkpoint debug "Starting module call"
        fn=$(sanitize "$1") || die
        shift 1
        "$fn" "$@"
        checkpoint debug "Finished module call"
    ;;


esac

checkpoint total
